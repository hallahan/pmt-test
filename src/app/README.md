# The `src/app` Directory

## Overview

* **src** - the application.
  * **app** - the application directory.
    * **about** - the about page.
      * **info** - the customizable section.
      * **less** - the less files.
      * **about.js** - the controller.
      * **about.spec.js** - the test.
      * **about.tpl.html** - the template.
    * **login** - the login page.
      * **less** - theless files.
      * **login.js** - the controller.
      * **login.spec.js** - the test.
      * **login.tpl.html** - the template.
    * **app.js** - the application controller.
    * **app.spec.js** - the test.
    * **config.js** - the configuration file generated by the build, based on _theme_.

The `src/app` directory contains all code specific to this application. Apart
from `app.js`, its tests & `config.js`, this directory is filled with subdirectories 
corresponding to "pages" or high-level sections of the application. Each directory can 
have as many subdirectories as it needs to maintain a logical organization of sub-sections.


## `app.js`

The main app configuration file. It kickstarts the whole process by requiring all the 
modules from `src/app` that are need. Only the top-level module needs to be loaded here.
For example in the about page there is a customizable section called info. The info module
is not required in `app.js` because it is pulled in by the about module. So only the about 
module (the highest level) is require, as it will ensure all its required submodules are 
included. 

Included in the `app.js` are the template requires for the template modules that are generated
during the build using HTML2JS (see build).

Any modules from `src/common` that are required by the app
submodules should also be included to ensure app-wide dependencies.

```

angular.module('pmtViewer', [

    'templates-app', // include template compilations from HTML2JS
    'templates-common', // include template compilations from HTML2JS
    'leaflet-directive', // include common directive
    'chart.js', // include common directive
    'pmtViewer.login', // include our sub-module
    'pmtViewer.about', // include our sub-module
    'ui.router', // angular require
    'config'        // include the config module generated by the grunt build from app.config.js

])

```

With app modules broken down in this way, all routing is performed by the
submodules we include, as that is where our app's functionality is really
defined.  So all we need to do in `app.js` is specify a default route to follow,
which route of course is defined in a submodule. In this case, our `login` module
is where we want to start, which has a defined route for `/login` in
`src/app/login/login.js`.

```js
.config( function myAppConfig ( $stateProvider, $urlRouterProvider ) {
  $urlRouterProvider.otherwise( '/login' );
})
```

Use the main applications run method to execute any code after services
have been instantiated.

```js
.run( function run () {
})
```

And then we define our main application controller. This is a good place for logic
not specific to the template or route, such as menu logic or page title wiring.

```js
.controller( 'AppCtrl', function AppCtrl ( $scope, $location ) {
  $scope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams){
    if ( angular.isDefined( toState.data.pageTitle ) ) {
      $scope.pageTitle = toState.data.pageTitle + ' | pmtViewer' ;
    }
  });
})
```

## `config.js`

This is the configuration file. The configuration file contains all the theme 
specific data (i.e. social media links, client business name, business url). The
build process requires a theme be specified so that it know's which configuration
file to build. All configuration files should contain the exact same objects,
however depending on the theme, certain elements may be empty. The config.js
is build from the app.config.js using grunt.

### Testing

One of the design philosophies of `pmtViewer` is that tests should exist
alongside the code they test and that the build system should be smart enough to
know the difference and react accordingly. As such, the unit test for `app.js`
is `app.spec.js`, though it is quite minimal.
